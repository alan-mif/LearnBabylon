# *Lesson 6 Sprite*

### 一、什么是 Sprite 以及 Sprite 的作用

**Sprite**，被称为精灵图（可能前端小伙伴更多称其为雪碧图），其本质就是一张 2D 的图片。它最为突出的作用就是在 3D 场景中，无论从什么角度看精灵图总是面对相机的。也就是说，我们总是能看到 2D 图片的全貌（排除精灵被遮挡或者精灵不在视口范围内的情况）。

我们知道在 3D 场景中想要实现复杂的物体或者效果是十分困难并且耗费性能的，如果我们可以用一张图片代替一些几何模型或者特效，那么就可以大量节省性能。这适用于这样一些场景，比如建筑物的文字标注（可以使用一张具有描述性文字的图片）雨雪粒子的模拟（可以使用一张雨或雪的图片）火焰效果的模拟等等

单个精灵图都被整合在一张图片中，这个图片一般被称作精灵表 **spritesheet**,把单个精灵图整合到一张图片上最大的好处就是节省请求数。每发出一个图片的http请求，除了下载该图片外，还要算进发送请求的时间，服务器端处理请求的时间和来回的网络延时（网络延时往往占据大多数耗时），因此对于小图片，这些额外耗时很可能远远超过文件本身所需的下载时间，比如下载1kb的图片只要30ms，但光网络延时就等待了100ms。把它们做进一张spritesheet就可以节省这些额外耗时。

**一致性精灵表 uniform spritesheet** 是一张特殊的图片，在图片中精灵图有完全一样的大小，并顺序的进行排列（本节课我们使用的便是一致性精灵表）

### 二、在 Babylon 中使用 Sprite

在 Babylon 中使用 Sprite 需要创建一个 SpriteManager，它的作用是监听和管理 spritesheet

```typescript
const spriteManager = new BABYLON.SpriteManager("SpriteManager", "./textures/player.png", 2000, {width: 64, height: 64}, scene);
```

  SpriteManager的参数如下所示：

- 名称：管理器的名称
- 图片URL链接：大多数时候会使用背景透明的png图片。
- 管理器的负载：相当于在管理器中可允许的最大精灵图数量
- 单元格尺寸，就像图片大小一样，指定精灵图的大小， **一致性精灵表** 的精灵图有完全一样的大小，这里就是指定这个大小，可以设置一个数字代表宽高一样，也可以设置一个对象单独指定宽高。
- 场景Scene实例，决定管理器添加到哪里。|

创建好管理器后，我们来创建一个精灵实例

```typescript
const sprite = new BABYLON.Sprite("sprite", spriteManager);
sprite.cellIndex = 0; // 指定精灵图（cellIndex在精灵表中的计数是从左到右，自上而下的）
```

好了，简单几步我们就把精灵图加入到了场景中。为了对比我们加入一个 立方体。

```typescript
const box = BABYLON.MeshBuilder.CreateBox('box', { height: 1, width: 1, depth: 1 }, scene); // 为了和对比精灵
box.position.y = -1; // 调整盒子坐标，避免挡住精灵图
```

现在你可以来观察一下这个精灵了（无论你怎么移动精灵始终面向你）。

在把精灵图加入到场景之后，我们还可以给它加一点点魔法~让精灵图可以动起来。原理很简单，就是是使用一致性精灵表和SpriteManager。只需载入一张大图片，里面包含了动画的所有帧，这些帧就是一张接一张的精灵图。请小心的指定精灵图的大小，精确到1个像素，避免动画失真。然后调用这个方法即可。

```typescript
// 将从0到43帧的顺序播放动画。第三个参数是指动画是否循环播放，true为循环。
// 最后一个参数表示播放速度，值越小，动画播放速度越快。
sprite.playAnimation(0, 43, true, 100); 
```

如果你使用本课程的精灵图应该已经可以播放这段动画了，你也可以动手自己制作一张精灵图来尝试一下~

以上就是本节课的全部内容了。接下来我们会用精灵图来做一些有意思的事情，比如粒子。不过在此之前我们要先介绍一下 Babylon 中的重力与碰撞检测（因为这样我们才能使粒子更加符合物理规律）。